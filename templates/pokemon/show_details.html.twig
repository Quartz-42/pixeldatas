{% extends 'base.html.twig' %}

{% set types_list = pokemon.types|map(t => t.name)|join(', ') %}
{% set page_title = pokemon.name ~ ' - Pokémon #' ~ pokemon.pokedexId ~ ' | PixelDatas' %}
{% set page_description = 'Découvrez ' ~ pokemon.name ~ ', Pokémon #' ~ pokemon.pokedexId ~ ' de type ' ~ types_list ~ '. Consultez ses statistiques, évolutions, talents et résistances.' %}
{% set page_keywords = 'Pokémon, ' ~ pokemon.name ~ ', ' ~ types_list ~ ', génération ' ~ pokemon.generation ~ ', Pokédex' %}

{% block title %}
	{{ page_title }}
{% endblock %}
{% block meta_description %}
	{{ page_description }}
{% endblock %}
{% block meta_keywords %}
	{{ page_keywords }}
{% endblock %}
{% block og_title %}
	{{ pokemon.name }}
	(#{{ pokemon.pokedexId }}) | PixelDatas
{% endblock %}
{% block og_image %}
	{{ absolute_url(pokemon.spriteRegular) }}
{% endblock %}

{% block flashes %}{% endblock %}

{% block content %}
	<div class="bg-red-600 p-4 min-h-screen flex flex-col">
		<div class="container mx-auto">
			{% include "shared/_flash.html.twig" %}
		</div>
		<div class="container  mx-auto text-center flex-grow">
			<div class="bg-white p-4 mt-4 mb-8 rounded-md relative">
				<h1 class="uppercase font-bold text-4xl mt-8">{{ pokemon.name }}</h1>
				<a href="{{ path('app_comparison_add', {'id': pokemon.id}) }}" class="absolute top-4 right-4 inline-flex items-center gap-1.5 md:gap-2 font-bold bg-black border border-black rounded text-amber-400 hover:text-amber-200 transition shadow text-xs px-3 py-1.5 md:text-sm md:px-5 md:py-2.5">
					<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 md:h-5 md:w-5" fill="none" viewbox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
					</svg>
					Comparer
				</a>
				{#CV POKEMON #}
				<div class="flex justify-center mt-[45px]">
					<div class="border border-dashed border-black shadow-md px-10 rounded flex w-full md:w-1/2 lg:w-2/3 items-center">
						<div class="w-1/3 justify-center hidden md:block lg:block">
							<img class="w-1/4 h-auto mx-auto" src="{{ asset('/img/pokeFact.png') }}" fetchpriority="high" alt="Icône PokéFact">
						</div>
						<div class="w-full md:w-2/3 lg:w-2/3 lg:text-lg md:text-base sm:text-sm text-center">
							<p class="mt-2 mb-2">
								{{pokemon.name}}
								est un Pokémon de type
								{% for type in pokemon.types %}
									<a href="{{ path('app_pokemon_type', {'type': type.name}) }}" class="font-bold underline">
										{{ type.name }}
									</a>
									{% if not loop.last %}
										/
									{% endif %}
								{% endfor %}
								appartenant à la
								<a href="{{ path('app_pokemon_gen', {'generation': pokemon.generation}) }}" class="font-bold underline">
									Gen.
									{{ pokemon.generation }}
								</a>
							</p>
							<p class="mt-2 mb-2">Il possède
								{% if pokemon.talent|length > 1 %}
									les talents
								{% else %}
									le talent
								{% endif %}
								{% for talent in pokemon.talent %}
									<strong>{{talent.name}}</strong>
									{% if not loop.last %}
										,
									{% endif %}
								{% endfor %}
							</p>
							{% if evoliNames is defined and evoliNames is not empty %}
								<p class="mt-2 mb-2">
									Ce Pokémon est instable génétiquement ! Il peut évoluer en :
									{% for evo in evoliNames %}
										<strong>
											<a class="underline" href="{{ path('app_pokemon_details', {'name': evo.name}) }}">
												{{ evo.name }}
											</a>
										</strong>
										{% if not loop.last %},
										{% endif %}
									{% endfor %}
								</p>
							{% elseif evolutions is not null and (evolutions.preEvolution1 is not null or evolutions.preEvolution2 is not null
						or evolutions.nextEvolution1 is not null or evolutions.nextEvolution2 is not null)
						 %}
								<p class="mt-2 mb-2">
									Ce Pokémon est
									<strong>évolutif !</strong>
									{% if evolutions.preEvolution1 is not null or evolutions.preEvolution2 is not null %}
										Il est l'évolution de
										{% if evolutions.preEvolution1 is not null %}
											<strong>
												<a class="underline" href="{{path('app_pokemon_details', {"name" : evolutions.preEvolution1.name})}}">
													{{ evolutions.preEvolution1.name }}
												</a>
											</strong>
										{% endif %}
										{% if evolutions.preEvolution2 is not null %}
											{% if evolutions.preEvolution1 is not null %}
												et de
											{% endif %}
											<strong>
												<a class="underline" href="{{path('app_pokemon_details', {"name" : evolutions.preEvolution2.name})}}">
													{{ evolutions.preEvolution2.name }}
												</a>
											</strong>
										{% endif %}
									{% endif %}
								</p>

								{% if evolutions.nextEvolution1 is not null or evolutions.nextEvolution2 is not null %}
									<p class="mt-2 mb-2">
										Son évolution suivante est
										{% if evolutions.nextEvolution1 is not null %}
											<strong>
												<a class="underline" href="{{path('app_pokemon_details', {"name" : evolutions.nextEvolution1.name})}}">
													{{ evolutions.nextEvolution1.name }}
												</a>
											</strong>
										{% endif %}
										{% if evolutions.nextEvolution2 is not null %}
											{% if evolutions.nextEvolution1 is not null %}
												puis
											{% endif %}
											<strong>
												<a class="underline" href="{{path('app_pokemon_details', {"name" : evolutions.nextEvolution2.name})}}">
													{{ evolutions.nextEvolution2.name }}
												</a>
											</strong>
										{% endif %}
									</p>
								{% endif %}

								{% if evolutions.isMegaEvolution %}
									<p class="mt-2 mb-2">
										La légende raconte même qu'il peut
										<strong>méga-évoluer !</strong>
									</p>
								{% endif %}
							{% else %}
								<p class="mt-2 mb-2">
									Ce Pokémon ne possède pas d'évolution
								</p>
							{% endif %}
						</div>
					</p>
				</div>
			</div>

			<div class="flex flex-col md:flex-row mt-8 justify-center items-center gap-8 md:gap-16 max-w-6xl mx-auto">
				<div class="w-full md:w-1/3 flex justify-center items-center">
					<img loading="lazy" src="{{ pokemon.spriteRegular }}" alt="Image de {{ pokemon.name }}" class="w-2/3 h-auto md:w-full drop-shadow-xl hover:scale-105 transition-transform duration-300" fetchpriority="high">
				</div>
				<div class="w-full md:w-1/2 bg-gray-50 backdrop-blur-sm p-4 mt-5 rounded-xl shadow-sm border border-gray-200">
					<h3 class="text-xl font-bold text-center text-gray-700 mb-4">Statistiques de base</h3>

					<div class="mt-4 flex justify-center gap-8 text-gray-700">
						{% if pokemon.weight %}
							<div class="text-center">
								<div class="text-sm text-gray-500">Poids</div>
								<div class="font-bold text-lg">{{ pokemon.weight }}</div>
							</div>
						{% endif %}

						{% if pokemon.height %}
							<div class="text-center">
								<div class="text-sm text-gray-500">Taille</div>
								<div class="font-bold text-lg">{{ pokemon.height }}</div>
							</div>
						{% endif %}
					</div>

					<div class="relative h-64 w-full">
						{{ render_chart(chart) }}
					</div>

					{% if pokemon.resistances is defined and pokemon.resistances|length > 0 %}
						<div class="mt-4 px-4">
							<div class="mb-3 flex items-center gap-2">
								<span class="font-bold text-red-600 w-24">Faiblesses</span>
								<div class="flex flex-wrap gap-1">
									{% for resistance in pokemon.resistances %}
										{% if resistance.multiplier > 1 %}
											<div class="w-8 h-8" title="{{ resistance.type.name }} (x{{ resistance.multiplier + 0 }})">
												{% if resistance.type.image %}
													<img src="{{ resistance.type.image }}" alt="{{ resistance.type.name }}" class="w-full h-full object-contain">
												{% else %}
													<span class="text-xs font-bold">{{ resistance.type.name|slice(0, 1) }}</span>
												{% endif %}
											</div>
										{% endif %}
									{% endfor %}
								</div>
							</div>

							<div class="flex items-center gap-2">
								<span class="font-bold text-green-600 w-24">Résistances</span>
								<div class="flex flex-wrap gap-1">
									{% for resistance in pokemon.resistances %}
										{% if resistance.multiplier < 1 %}
											<div class="w-8 h-8 {% if resistance.multiplier == 0 %}opacity-50{% endif %}" title="{{ resistance.type.name }} (x{{ resistance.multiplier + 0 }})">
												{% if resistance.type.image %}
													<img src="{{ resistance.type.image }}" alt="{{ resistance.type.name }}" class="w-full h-full object-contain">
												{% else %}
													<span class="text-xs font-bold">{{ resistance.type.name|slice(0, 1) }}</span>
												{% endif %}
											</div>
										{% endif %}
									{% endfor %}
								</div>
							</div>
						</div>
					{% endif %}

				</div>
			</div>

			<div class="flex flex-wrap justify-center md:space-x-10 lg:space-x-10 my-11">
				{% if pokemon.spriteShiny %}
					<div class="border border-dashed border-black shadow-md rounded flex flex-col items-center w-full md:w-full lg:w-1/4 mb-4">
						<h2 class="font-bold text-xl mt-4">Forme Shiny</h2>
						<img loading="lazy" class="w-2/3 h-auto mt-4 mb-4" src="{{ pokemon.spriteShiny }}" alt="Shiny Pokemon Image" fetchpriority="high">
					</div>
				{% endif %}

				{% if pokemon.spriteGmax %}
					<div class="border border-dashed border-black shadow-md rounded flex flex-col items-center w-full md:w-full lg:w-1/4 mb-4">
						<h2 class="font-bold text-xl mt-4">Forme GMAX</h2>
						<img loading="lazy" class="w-2/3 h-auto mt-4 mb-4" src="{{ pokemon.spriteGmax }}" alt="GMAX Pokemon Image" fetchpriority="high">
					</div>
					<div class="border border-dashed border-black shadow-md rounded flex flex-col items-center w-full md:w-full lg:w-1/4 mb-4">
						<h2 class="font-bold text-xl mt-4">Forme GMAX Shiny</h2>
						<img loading="lazy" class="w-2/3 h-auto mt-4 mb-4" src="{{ pokemon.spriteGmaxShiny }}" alt="Shiny GMAX Pokemon Image" fetchpriority="high">
					</div>
				{% endif %}
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script type="application/ld+json">
		{
				"@context": "https://schema.org",
				"@type": "VideoGameCharacter",
				"name": "{{ pokemon.name }}",
				"identifier": "#{{ pokemon.pokedexId }}",
				"image": "{{ absolute_url(pokemon.spriteRegular) }}",
				"description": "{{ page_description }}",
				"inVideoGame": {
					"@type": "VideoGameSeries",
					"name": "Pokémon",
					"publisher": {
						"@type": "Organization",
						"name": "Nintendo"
					}
				}
		{% if pokemon.types|length > 0 %},
					"additionalProperty": [
			{% for type in pokemon.types %}
				{
								"@type": "PropertyValue",
								"name": "Type",
								"value": "{{ type.name }}"
							}
				{% if not loop.last %},
				{% endif %}
			{% endfor %}
			]
		{% endif %}
		}
	</script>
{% endblock %}
